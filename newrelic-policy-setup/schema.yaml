title: New Relic Policy Setup
name: newrelic-stack-setup
description: This is used to configure the New Relic Dynamic Group, Policies, Key Vault and Link to the Newrelic Account.
schemaVersion: 1.1.0
version: 1.0
locale: "en"
groupings:
  - title: "New Relic Environment Configuration"
    variables:
      - ${tenancy_ocid}
      - ${newrelic_endpoint}
      - ${newrelic_ingest_api_key}
      - ${newrelic_user_api_key}
      - ${newrelic_account_id}
      - ${link_account_name}
      - ${policy_stack}
  - title: "OCI WIF Configuration"
    visible:
      or:
        - eq:
            - ${policy_stack}
            - "METRICS,COMMON"
        - eq:
            - ${policy_stack}
            - "LOGS,COMMON"
        - eq:
            - ${policy_stack}
            - "METRICS,LOGS,COMMON"
    variables:
      - ${client_id}
      - ${client_secret}
      - ${oci_domain_url}
      - ${svc_user_name}

variables:
  tenancy_ocid:
    type: string
    title: Tenancy OCID
    description: OCI tenant OCID, more details can be found at https://docs.cloud.oracle.com/en-us/iaas/Content/API/Concepts/apisigningkey.htm#five
    required: true
    visible: true

  current_user_ocid:
    type: string
    title: User OCID
    description: The OCID of the current user executing the terraform script.
    required: true
    visible: false

  region:
    type: string
    title: Region
    description: OCI Region as documented at https://docs.cloud.oracle.com/en-us/iaas/Content/General/Concepts/regions.htm
    required: true
    visible: false

  compartment_ocid:
    type: string
    title: Compartment OCID
    description: The OCID of the compartment where the resources will be created.
    required: true
    visible: false

  newrelic_endpoint:
    type: enum
    title: New Relic Endpoint
    description: The endpoint to hit for sending the metrics. Varies by region [Staging|US|EU]
    required: true
    allowMultiple: false
    default: newrelic-staging-metric-api
    visible:
      or:
        - eq:
            - ${policy_stack}
            - "METRICS,COMMON"
        - eq:
            - ${policy_stack}
            - "LOGS,COMMON"
        - eq:
            - ${policy_stack}
            - "METRICS,LOGS,COMMON"
    enum:
      - newrelic-staging-metric-api
      - newrelic-staging-vortex-metric-api
      - newrelic-metric-api
      - newrelic-eu-metric-api

  newrelic_ingest_api_key:
    type: password
    title: New Relic Ingest - License API Key
    description: The Ingest License API key for sending metrics to New Relic endpoints
    required: true
    sensitive: true
    visible:
      or:
        - eq:
            - ${policy_stack}
            - "METRICS,COMMON"
        - eq:
            - ${policy_stack}
            - "LOGS,COMMON"
        - eq:
            - ${policy_stack}
            - "METRICS,LOGS,COMMON"

  newrelic_user_api_key:
    type: password
    title: New Relic User API Key
    description: The User API key for Linking the OCI Account to the New Relic account
    required: true
    sensitive: true
    visible:
      or:
        - eq:
            - ${policy_stack}
            - "METRICS,COMMON"
        - eq:
            - ${policy_stack}
            - "LOGS,COMMON"
        - eq:
            - ${policy_stack}
            - "METRICS,LOGS,COMMON"

  newrelic_account_id:
    type: string
    title: New Relic Account ID
    description: The New Relic Account ID for linking the OCI account to the New Relic account
    required: true
    sensitive: true
    confirmation: true
    visible:
      or:
        - eq:
            - ${policy_stack}
            - "METRICS,COMMON"
        - eq:
            - ${policy_stack}
            - "LOGS,COMMON"
        - eq:
            - ${policy_stack}
            - "METRICS,LOGS,COMMON"

  link_account_name:
    type: string
    title: New Relic Link Account Name
    description: The name to assign to the linked account in New Relic
    required: true
    visible:
      or:
        - eq:
            - ${policy_stack}
            - "METRICS,COMMON"
        - eq:
            - ${policy_stack}
            - "LOGS,COMMON"
        - eq:
            - ${policy_stack}
            - "METRICS,LOGS,COMMON"

  policy_stack:
    type: string
    title: New Relic Policy Instrumentation
    description: A string indicating which parts of the stack to deploy. Use comma-separated values from METRICS, LOGS, COMMON.
    visible: true
    required: true

  client_id:
    type: string
    title: Client ID
    description: The Client ID for OCI tenancy, needed for metadata polling from New Relic.
    required: true
    visible: true

  client_secret:
    type: string
    title: Client Secret
    description: The Client Secret for the OCI tenancy, needed for metadata polling from New Relic.
    required: true
    sensitive: true
    password: true
    confirmation: true

  oci_domain_url:
    type: string
    title: OCI Domain URL
    description: The OCI Domain URL, usually https://identity.<region>.oraclecloud.com
    required: true
    visible: true

  svc_user_name:
    type: string
    title: Service User Name
    description: The name of the service user created in OCI for New Relic to access the tenancy.
    required: true
    visible: true


