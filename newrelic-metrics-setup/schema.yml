title: New Relic Configuration for Sending Metrics
name: newrelic-stack-setup
description: This is used to configure the New Relic setup for sending metrics from various OCI services.
schemaVersion: 1.1.0
version: 1.0
locale: "en"
variableGroups:
  - title: "New Relic Environment Configuration"
    variables:
      - ${newrelic_endpoint}
      - ${nr_prefix}
      - ${home_secret_ocid}
  - title: "Network options"
    variables:
      - ${create_vcn}
      - ${vcnCompartment}
      - ${existingVcn}
      - ${function_subnet_id}
  - title: "Metrics settings"
    variables:
      - ${metrics_namespaces}

variables:
  tenancy_ocid:
    type: string
    title: Tenancy OCID
    description: OCI tenant OCID, more details can be found at https://docs.cloud.oracle.com/en-us/iaas/Content/API/Concepts/apisigningkey.htm#five
    required: true
    visible: false

  compartment_ocid:
    type: string
    title: Compartment OCID
    description: The OCID of the compartment where the resources will be created.
    required: true
    visible: false

  region:
    type: string
    title: Region
    description: OCI Region as documented at https://docs.cloud.oracle.com/en-us/iaas/Content/General/Concepts/regions.htm
    required: true
    visible: false

  nr_prefix:
    type: string
    title: New Relic prefix
    description: The prefix to use for New Relic resources for Function and VCNs.
    required: true
    default: newrelic

  newrelic_endpoint:
    type: enum
    title: New Relic Endpoint
    description: The endpoint to hit for sending the metrics. Varies by region [Staging|US|EU]
    required: true
    allowMultiple: false
    default: newrelic-staging-metric-api
    enum:
      - newrelic-staging-metric-api
      - newrelic-staging-vortex-metric-api
      - newrelic-metric-api
      - newrelic-eu-metric-api

  home_secret_ocid:
    type: string
    title: Home Vault Secret OCID
    description: The OCID of the secret in the home region that contains the New Relic Ingest API key.
    required: true
    visible: true

  create_vcn:
    title: Create VCN
    description: Create virtual network (VCN) for the function setup. If using existing networking resources, de-select "Create VCN" and select the relevant VCN and subnet to use.
    type: boolean
    default: true

  vcnCompartment:
    type: oci:identity:compartment:id
    visible:
      not:
        - ${create_vcn}
  existingVcn:
    type: oci:core:vcn:id
    visible:
      not:
        - ${create_vcn}
    dependsOn:
      compartmentId: ${vcnCompartment}
  function_subnet_id:
    title: Function Subnet OCID
    type: oci:core:subnet:id
    visible:
      not:
        - ${create_vcn}
    description: The subnet to be used by the function app that will be deployed. If "Create VCN" is selected, the new VCN will overwrite this selection..
    required: false
    dependsOn:
      compartmentId: ${vcnCompartment}
      vcnId: ${existingVcn}

  metrics_namespaces:
    title: Metrics namespaces
    type: enum
    description: The list of namespaces to send metrics for, within their respective compartments. Remove any namespaces where metrics should not be sent.
    required: true
    additionalProps:
      allowMultiple: true
    default:
      - "oci_apigateway"
      - "oci_autonomous_database"
      - "oci_blockstore"
      - "oci_compute"
      - "oci_compute_infrastructure_health"
      - "oci_compute_instance_health"
      - "oci_computeagent"
      - "oci_database"
      - "oci_database_cluster"
      - "oci_faas"
      - "oci_healthchecks"
      - "oci_internet_gateway"
      - "oci_lbaas"
      - "oci_logging"
      - "oci_nat_gateway"
      - "oci_nlb"
      - "oci_nlb_extended"
      - "oci_nosql"
      - "oci_objectstorage"
      - "oci_oke"
      - "oci_postgresql"
      - "oci_service_connector_hub"
      - "oci_service_gateway"
      - "oci_vcn"
      - "oci_vcnip"
      - "oci_vmi_resource_utilization"
    enum:
      - "oci_apigateway"
      - "oci_autonomous_database"
      - "oci_blockstore"
      - "oci_compute"
      - "oci_compute_infrastructure_health"
      - "oci_compute_instance_health"
      - "oci_computeagent"
      - "oci_database"
      - "oci_database_cluster"
      - "oci_faas"
      - "oci_healthchecks"
      - "oci_internet_gateway"
      - "oci_lbaas"
      - "oci_logging"
      - "oci_nat_gateway"
      - "oci_nlb"
      - "oci_nlb_extended"
      - "oci_nosql"
      - "oci_objectstorage"
      - "oci_oke"
      - "oci_postgresql"
      - "oci_service_connector_hub"
      - "oci_service_gateway"
      - "oci_vcn"
      - "oci_vcnip"
      - "oci_vmi_resource_utilization"
